### Local bashrc file containing system-specific settings

## Set up pyenv
export PYENV_ROOT="$HOME/.pyenv"
[[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init -)"

## Set up Google Clound SDK
# The next line updates PATH for the Google Cloud SDK.
if [ -f '/opt/google-cloud-sdk/path.bash.inc' ]; then . '/opt/google-cloud-sdk/path.bash.inc'; fi
# The next line enables shell command completion for gcloud.
if [ -f '/opt/google-cloud-sdk/completion.bash.inc' ]; then . '/opt/google-cloud-sdk/completion.bash.inc'; fi


########## Prompt ##########
# References: https://misc.flogisoft.com/bash/tip_colors_and_formatting
#             https://tldp.org/HOWTO/Bash-Prompt-HOWTO/bash-prompt-escape-sequences.html
export GIT_PS1_SHOWDIRTYSTATE=1
RESTORE='\[\e[0m\]'
export PS1="\[\e[00;42;30m\][\w]${RESTORE}\[\e[33m\]\$(__git_ps1 \"[\[\e[03m\]%s\[\e[23m\]]\")${RESTORE} â¨• "

########## Variables ##########
# macOS automatically adds all paths in /etc/paths.d
export PATH="$HOME/scripts:$PATH"
# export EDITOR="emacs.sh -s cli_server"
# export EDITOR="emacsclient -s ${EMACS_SERVER_DIR}/cli_server" # this is more lightweight then calling emacs.sh,  but emacs server must have been started

########## Alias ##########
alias typora="open -a typora"
alias ssh="ssh.sh"

########## Miniconda ##########
# Activate environment:   conda activate <env>
# Deactivate environment: conda deactivate
if [ -f "/opt/conda/etc/profile.d/conda.sh" ]; then
    . "/opt/conda/etc/profile.d/conda.sh"
else
    export PATH="/opt/conda/bin:$PATH"
fi

########## Completion ##########
if type brew &>/dev/null
then
    HOMEBREW_PREFIX="$(brew --prefix)"
    if [[ -r "${HOMEBREW_PREFIX}/etc/profile.d/bash_completion.sh" ]]
    then
        source "${HOMEBREW_PREFIX}/etc/profile.d/bash_completion.sh"
    else
        for COMPLETION in "${HOMEBREW_PREFIX}/etc/bash_completion.d/"*
        do
            [[ -r "${COMPLETION}" ]] && source "${COMPLETION}"
        done
    fi
fi


########## fzf ##########
# Auto-completion
source "/opt/homebrew/opt/fzf/shell/completion.bash" 2> /dev/null
# Key bindings
source "/opt/homebrew/opt/fzf/shell/key-bindings.bash"
